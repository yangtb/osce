<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.osce.orm.biz.monitor.PfAreaMonitorDao">
    <update id="recoveryTest">
        update es_exec_queue set sd_exec_queue = 1
        where
            id_exec_queue in (
        <foreach collection="list" item="item" separator="," >
            #{item}
        </foreach>
        )
    </update>
    <delete id="delAreaStu">
        delete from
            tp_ins_station_detail
        where
            id_ins_station_detail in (
        <foreach collection="list" item="item" separator="," >
            #{item}
        </foreach>
        )
    </delete>

    <select id="listToBeExaminedStu" resultType="com.osce.vo.biz.monitor.MonitorStuVo">
        SELECT
            id_ins_station_detail ,
            id_user ,
            user_cd ,
            real_name ,
            phone_no ,
            CONCAT(LEFT(idcard,2), '************', RIGHT(idcard,4)) as idCard
        FROM
            v_we_show_detail
        where
            id_plan = #{idPlan}
        AND id_area = #{idArea}
        AND time_section = #{timeSection}
        AND statusNum = 0
        ORDER BY
            id_ins_station_detail
    </select>
    <select id="listOnSiteStu" resultType="com.osce.vo.biz.monitor.MonitorStuVo">
        SELECT
            v.id_ins_station_detail ,
            v.id_user ,
            v.user_cd ,
            v.real_name ,
            v.phone_no ,
            CONCAT(LEFT(v.idcard,2), '************', RIGHT(v.idcard,4)) as idCard,
            e.na_station ,
            c.na_area ,
            d.na_room ,
            LPAD(a.no_reg, 2, 0) as no_reg ,
            b.act_begin
        FROM
            v_we_show_detail v
        LEFT JOIN we_waiting_reg a ON v.id_ins_station_detail = a.id_waiting_reg
        LEFT JOIN es_exec_queue b ON a.id_waiting_reg = b.id_waiting_reg
        LEFT JOIN td_area c ON b.id_area = c.id_area
        LEFT JOIN erp_room d ON b.id_room = d.id_room
        LEFT JOIN td_station e ON b.id_station = e.id_station
        WHERE
            v.id_plan = #{idPlan}
        AND v.id_area = #{idArea}
        AND v.time_section = #{timeSection}
        AND v.statusNum >= 1 AND v.statusNum &lt;= 5
        ORDER BY
            v.id_ins_station_detail
    </select>
    <select id="listEndStu" resultType="com.osce.vo.biz.monitor.MonitorStuVo">
        SELECT
            b.id_exec_queue ,
            v.id_user ,
            v.user_cd ,
            v.real_name ,
            v.phone_no ,
            CONCAT(LEFT(v.idcard,2), '************', RIGHT(v.idcard,4)) as idCard,
            e.na_station ,
            c.na_area ,
            d.na_room ,
            LPAD(a.no_reg, 2, 0) as no_reg ,
            b.act_begin ,
            statusNum as endStatus
        FROM
            v_we_show_detail v
        LEFT JOIN we_waiting_reg a ON v.id_ins_station_detail = a.id_waiting_reg
        LEFT JOIN es_exec_queue b ON a.id_waiting_reg = b.id_waiting_reg
        LEFT JOIN td_area c ON b.id_area = c.id_area
        LEFT JOIN erp_room d ON b.id_room = d.id_room
        LEFT JOIN td_station e ON b.id_station = e.id_station
        WHERE
            v.id_plan = #{idPlan}
        AND v.id_area = #{idArea}
        AND v.time_section = #{timeSection}
        AND v.statusNum = -1 or v.statusNum = 6
        ORDER BY
            b.id_exec_queue
    </select>
    <select id="listMonitorArea" resultType="com.osce.vo.biz.monitor.MonitorAreaVo">
        SELECT
            v.id_ins_station ,
            v.id_score_sheet ,
            v.na_station ,
            v.id_room ,
            b.na_room ,
            v.min_cost ,
            v.sd_station_ca ,
            v.sd_skill_ca ,
            v.na_paper ,
            v.des_paper ,
            v.id_user_manager ,
            c.real_name ,
            (
                SELECT
                    sd_exec_queue
                FROM
                    es_exec_queue
                WHERE
                    v.id_plan = es_exec_queue.id_plan
                AND v.id_area = es_exec_queue.id_area
                AND v.time_section = es_exec_queue.time_section
                AND v.id_station = es_exec_queue.id_station
                AND v.id_room = es_exec_queue.id_room
                AND sd_exec_queue IN ('2' , '3' , '4')
            ) AS sd_exec_queue
        FROM
            v_es_get_site_infor v
        LEFT JOIN erp_room b ON v.id_room = b.id_room
        LEFT JOIN user_info c ON v.id_user_manager = c.user_id
        WHERE
            v.id_plan = #{idPlan}
        AND v.id_area = #{idArea}
        AND v.time_section = #{timeSection}
    </select>
    <select id="listCurrentPlan" resultType="com.osce.vo.biz.show.ShowAioMainVo">
        SELECT
            id_plan ,
            id_area ,
            time_section
        FROM
            v_we_show_main
        WHERE
            id_org = #{idOrg}
        AND plan_day = DATE(NOW())
        <if test="amPmFlag == 0">
            AND time_begin &lt;= '12:00:00'
        </if>
        <if test="amPmFlag == 1">
            AND time_begin > '12:00:00'
        </if>
    </select>
    <select id="selectMonitorAreaDetail" resultType="com.osce.vo.biz.monitor.MonitorAreaDetailVo">
        SELECT
            a.id_plan ,
            a.id_area ,
            a.time_section ,
            a.id_room ,
            b.id_case ,
            a.id_score_sheet ,
            b.na_score_sheet
        FROM
            tp_ins_station a
        LEFT JOIN td_score_sheet b ON a.id_score_sheet = b.id_score_sheet
        WHERE
            id_ins_station = #{idInsStation}
    </select>
    <select id="listItem" resultType="com.osce.entity.TdScoreItem">
        SELECT
            a.na_score_item ,
            a.des_score_item ,
            a.score
        FROM
            td_score_item a
        WHERE
            a.id_score_sheet = #{idScoreSheet}
        AND a.id_org = #{idOrg}
        AND a.fg_active = '1'
    </select>
</mapper>